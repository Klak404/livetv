<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Live TV Player (Vercel Auto)</title>
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; background: black; overflow: hidden; }
    #player-hls, #player-yt { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div id="player-hls"></div>
  <div id="player-yt" class="hidden"></div>

  <script>
    let currentSource = "";
    let currentType = "";
    let hlsPlayer = null;
    let ytPlayer = null;
    let ytApiReady = false;

    // YouTube API Init
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);
    window.onYouTubeIframeAPIReady = () => { ytApiReady = true; };

    async function checkUpdates() {
      try {
        const response = await fetch('/api/set-channel?t=' + Date.now());
        const data = await response.json();

        if (data.currentSource !== currentSource || data.type !== currentType) {
          currentSource = data.currentSource;
          currentType = data.type;
          renderPlayer(data);
        }
      } catch (e) { console.error("API Error:", e); }
    }

    function renderPlayer(data) {
      document.getElementById('player-hls').classList.add('hidden');
      document.getElementById('player-yt').classList.add('hidden');
      if (hlsPlayer) { hlsPlayer.destroy(); hlsPlayer = null; }
      if (ytPlayer) { document.getElementById('player-yt').innerHTML = ""; ytPlayer = null; }

      if (data.type === "hls") {
        document.getElementById('player-hls').classList.remove('hidden');
        hlsPlayer = new Clappr.Player({
          source: data.currentSource,
          parentId: "#player-hls",
          autoPlay: true,
          width: "100%", height: "100%"
        });
      } 
      else if (data.type === "youtube" && ytApiReady) {
        document.getElementById('player-yt').classList.remove('hidden');
        ytPlayer = new YT.Player('player-yt', {
          videoId: data.currentSource,
          playerVars: { autoplay: 1, controls: 1 }
        });
      }
    }

    setInterval(checkUpdates, 5000); // Έλεγχος κάθε 5 δευτερόλεπτα
    checkUpdates();
  </script>
  <script src="../controls.js"></script>
</body>
</html>
